<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CHAT PAGE</title>
  <style>
    .embeddedServiceHelpButton .helpButton .uiButton {
      background-color: #005290;
      font-family: "Arial", sans-serif;
    }

    .embeddedServiceHelpButton .helpButton .uiButton:focus {
      outline: 1px solid #005290;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
  </style>
  <script type="text/javascript" src="https://service.force.com/embeddedservice/5.0/esw.js"></script>
  <script>
    function isMobile() {
      return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    }

    function sendSizeToParent(height, width) {
      window.parent.postMessage({
        frameHeight: height,
        frameWidth: width,
      }, '*'); // Use '*' for simplicity or restrict to the parent's domain for security
    }

    const initESW = function (gslbBaseURL) {
      embedded_svc.settings.displayHelpButton = true;
      embedded_svc.settings.language = 'en-US';
      embedded_svc.settings.devMode = true;
      embedded_svc.settings.widgetWidth = 320;
      embedded_svc.settings.widgetHeight = 498;
      embedded_svc.settings.enabledFeatures = ['LiveAgent'];
      embedded_svc.settings.entryFeature = 'LiveAgent';

      embedded_svc.init(
        'http://localhost.internal.salesforce.com:6109',
        'http://localhost.force.com:6109/test1',
        gslbBaseURL,
        '00Dxx0000001gEW',
        'omni_1',
        {
          baseLiveAgentContentURL: 'path/to/baseLiveAgentContentURL',
          deploymentId: '572xx0000000001',
          buttonId: '573xx0000000001',
          baseLiveAgentURL: 'path/to/baseLiveAgentURL',
          eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04IRM0000004Dv12AE_16c4e028e49',
          isOfflineSupportEnabled: true
        }
      );

      // Send appropriate sizes for mobile or desktop when minimized
      embedded_svc.addEventHandler("afterMinimize", function () {
        const sidebar = document.querySelector('.embeddedServiceSidebarMinimizedDefaultUI');
        sendSizeToParent(sidebar.clientHeight, sidebar.clientWidth);
      });

      // Adjust to full-screen size on mobile when maximized
      embedded_svc.addEventHandler("afterMaximize", function () {
        const isFullScreen = isMobile();

        if (isFullScreen) {
          const height = window.innerHeight;
          const width = window.innerWidth;
          sendSizeToParent(height, width);
        } else {
          sendSizeToParent(embedded_svc.settings.widgetHeight, embedded_svc.settings.widgetWidth);
        }
      });

      embedded_svc.addEventHandler("afterDestroy", function () {
        const helpButton = document.querySelector('.helpButton');
        sendSizeToParent(helpButton.clientHeight, helpButton.clientWidth);
      });
    };

    if (!window.embedded_svc) {
      const script = document.createElement('script');
      script.setAttribute('src', 'https://service.force.com/embeddedservice/5.0/esw.js');
      script.onload = function () {
        initESW(null);
      };
      document.body.appendChild(script);
    } else {
      initESW(null);
    }
  </script>
</head>
<body>
  <h1>Salesforce Chat</h1>
</body>
</html>
